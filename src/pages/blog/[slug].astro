---
import { getEntryBySlug, getCollection } from 'astro:content';
import PostLayout from '../../layouts/PostLayout.astro';
export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.filter(post => !post.data.draft).map(post => ({
    params: { slug: post.slug },
    props: { slug: post.slug }
  }));
}

const { slug } = Astro.props;
const post = await getEntryBySlug('posts', slug);
if (!post) throw new Error('Post not found');
const {
  title,
  description,
  pubDate,
  updatedDate,
  tags,
  affiliateDisclosure
} = post.data;
const canonical = `https://tfs2006.github.io/the_tiny_house_nation/blog/${slug}/`;
const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: title,
  datePublished: pubDate.toISOString(),
  dateModified: (updatedDate ?? pubDate).toISOString(),
  author: {
    '@type': 'Person',
    name: 'The Tiny House Nation'
  },
  mainEntityOfPage: canonical
};
---
<PostLayout {title} {description} {canonical} showAffiliateDisclosure={affiliateDisclosure}>
  <article>
    <h1>{title}</h1>
    <p><small>Published: {pubDate.toLocaleDateString()}</small></p>
    {updatedDate && <p><small>Updated: {updatedDate.toLocaleDateString()}</small></p>}
    <div>
      {post.body}
    </div>
    <script type="application/ld+json">{JSON.stringify(jsonLd)}</script>
  </article>
</PostLayout>
